<!DOCTYPE html>
<html>
<title>Messenger</title>
<head style="align:center;font-weight:bold">

 <script>
function getNewXmlHttp(){
var xmlhttp;
if (window.XMLHttpRequest)
  {
  xmlhttp=new XMLHttpRequest();
  }
else
  {
  xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
  }
  return xmlhttp;
}

var request = 0;
function DisplayUserProfile(){

  var xmlhttp = getNewXmlHttp();
  //alert(id + " " + profilename);
  xmlhttp.onreadystatechange = function(){
  if (xmlhttp.readyState==4 && xmlhttp.status==200)
    {
      var metaData=xmlhttp.responseText;
      metaData=JSON.parse(metaData);
      //getImage(metaData.image[0].url);
      var id=document.getElementById("userId").value;
      
      for(var i=0;i<metaData.length;i++){
    	  if(metaData[i].id==id){
    	  	document.getElementById("UserName").innerHTML=metaData[i].profileName;
        }
	}
    }  
  }

  xmlhttp.open("GET","http://localhost:8080/FbMessenger/webapi/profiles",true);
  xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
  xmlhttp.send();
}
function DisplayMessages(){

  var xmlhttp1 = getNewXmlHttp();
  //alert(id + " " + profilename);
  alert("Hi");
  xmlhttp1.onreadystatechange = function(){
  if (xmlhttp1.readyState==4 && xmlhttp1.status==200)
    {
      var metaData=xmlhttp1.responseText;
      metaData=JSON.parse(metaData);
      	//var textnode = document.createTextNode("Water");
      //alert("Hi");
      //getImage(metaData.image[0].url);
      var Msg=document.getElementById("Messages");
      var node = document.createElement("LI");
  	  var displaymessage="";
      var textnode;
      document.getElementById("Messages").innerHTML="";
      for(var i=0;i<metaData.length;i++){
      		textnode= document.createTextNode(metaData[i].message);
      		var node = document.createElement("LI");
      		node.appendChild(textnode);
    		document.getElementById("Messages").appendChild(node);
    
      		//displaymessage.appendChild(metaData[i].message);
      		//alert(metaData[i].message);
   		}
   		//document.getElementById("Messages").innerHTML=displaymessage;
    }  
  }

  xmlhttp1.open("GET","http://localhost:8080/FbMessenger/webapi/messages",true);
  xmlhttp1.setRequestHeader("Content-type","application/x-www-form-urlencoded");
  xmlhttp1.send();
}

function addMessage(){

  var xmlhttp1 = getNewXmlHttp();
  //alert(id + " " + profilename);
  alert("Hi");
  xmlhttp1.onreadystatechange = function(){
  if (xmlhttp1.readyState==4 && xmlhttp1.status==200)
    {
      var metaData=xmlhttp1.responseText;
      metaData=JSON.parse(metaData);
      alert("Msg Added");
      	//var textnode = document.createTextNode("Water");
      //alert("Hi");
      //getImage(metaData.image[0].url);
     //  var Msg=document.getElementById("Messages");
     //  var node = document.createElement("LI");
  	  // var displaymessage="";
     //  var textnode;
     //  for(var i=0;i<metaData.length;i++){
     //  		textnode= document.createTextNode(metaData[i].message);
     //  		var node = document.createElement("LI");
     //  		node.appendChild(textnode);
    	// 	document.getElementById("Messages").appendChild(node);
    
      		//displaymessage.appendChild(metaData[i].message);
      		//alert(metaData[i].message);
   		}
   		//document.getElementById("Messages").innerHTML=displaymessage;
    }  
  
  var msgid=document.getElementById("msgId").value;
  var msg=document.getElementById("newmsg").value;
  var msgAuthor=document.getElementById("msgauthor").value;
  alert(msgid + " " + msg + " "+ msgAuthor);
 // var json_upload = JSON.stringify({id:msgid,message:msg,author:msgAuthor});
  xmlhttp1.open("POST","http://localhost:8080/FbMessenger/webapi/messages",true);
  xmlhttp1.setRequestHeader("Content-type","application/json;charset=UTF-8");
  xmlhttp1.send(JSON.stringify({"id":msgid,"message":msg,"author":msgAuthor}));
}


</script>



</head>
<body>
	<div style="float:left">
		<input type="number" id="userId" placeholder="User Id">
		<label id="UserName" style="font-weight:bold">Profile Name</label><br/>
		<input type="submit" value="Login" onClick="DisplayUserProfile()"><br/>
		<input type="submit" value="Show All Messages" onClick="DisplayMessages()"><br/>
		<input type="textarea" id="msgId" rows="10" cols="25" placeholder="Enter MsgId"><br/>
		<input type="textarea" id="newmsg" rows="10" cols="25" placeholder="Enter Message"><br/>
		<input type="textarea" id="msgauthor" rows="10" cols="25" placeholder="Author"><br/>
		<input type="submit" value="AddMessage" onClick="addMessage()"><br/>

		<input type="textarea" id="msggId" rows="10" cols="25" placeholder="Enter MsgId"><br/>		
		<input type="textarea" id="cmtId" rows="10" cols="25" placeholder="Enter CmtId"><br/>
		<input type="textarea" id="newcmt" rows="10" cols="25" placeholder="Enter Comment"><br/>
		<input type="textarea" id="cmtauthor" rows="10" cols="25" placeholder="Author"><br/>
		<input type="submit" value="Add Message" onClick="addComment()"><br/>
		
	</div>
		<div style="width:600px;height:600px;float:right;align:center;border-style:solid;margin:20px 300px 20px 20px">
			<div style="text-size:20px;font-weight:bold">Messsages:</div>
			
				<ul id="Messages"></ul>
		</div>
	
</body>

</html>