<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>Home</title>
<script>
function getList() {
	var xmlhttp =new XMLHttpRequest();
	  //if(pathParam != " " && pathParam != null && pathParam != "") {
	  	xmlhttp.open("GET","http://localhost:8080/assignmentJ2EE/login", true);
	  	//xmlhttp.open("POST","http://localhost:8080/assignmentJ2EE/home?message="+ pathParam + "&user=" + user, true);
	  	xmlhttp.send();
	  	pathParam = "";
	  	xmlhttp.onreadystatechange = function() {
			  if(xmlhttp.readyState==4) {
			          	document.getElementById("ausers").innerText = xmlhttp.responseText;
			  }
		  }
	  //}
}

function doAjax() {
setInterval(function(){
	  var xmlhttp =new XMLHttpRequest();
	  var pathParam= document.getElementById("msg").value;
	  document.getElementById("msg").value = "";
	  var user = "user";	
	  var chat = document.getElementById("chat").value;
	  
	  var query = window.location.search.substring(1);
	  var vars = query.split("&");
	  for (var i=0;i<vars.length;i++) {
	    var pair = vars[i].split("=");
	    if (pair[0] == "username") {
	      user = pair[1];
	    }
	  }
	  
	  //if(pathParam != " " && pathParam != null && pathParam != "") {
	  	xmlhttp.open("GET","http://localhost:8080/assignmentJ2EE/home?message="+ pathParam + "&user=" + user, true);
	  	//xmlhttp.open("POST","http://localhost:8080/assignmentJ2EE/home?message="+ pathParam + "&user=" + user, true);
	  	xmlhttp.send();
	  	pathParam = "";
	  	xmlhttp.onreadystatechange = function() {
			  if(xmlhttp.readyState==4) {
			          	document.getElementById("chat").innerText += xmlhttp.responseText;
			  }
		  }
	  //}
		  
},2000);
}
</script>
</head>
<body>
<h1> Chat Room </h1>
<div id="ausers"> </div>
<button type="submit" onclick="getList();"> Active Users </button>
 <br/>
<form action="logout" method="post">
<button type="submit" onclick="doAjax();"> Logout </button>
 <br/>
 </form>
<p id="chat" name="chat"> </p> <br/> <br/>

<textarea name="msg" placeholder="Enter message here!!!!" id="msg"> </textarea> 
<br>
<button type="submit" onclick="doAjax();"> Send </button>
 <br/>
<p id="auser" name="auser"> </p>
</body>
</html>